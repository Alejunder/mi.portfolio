import React, { useState, useRef, useEffect, useCallback } from "react";
// eslint-disable-next-line no-unused-vars
import { motion } from "framer-motion";
import { useTranslation } from 'react-i18next';

const ProjectCarousel = ({ projects }) => {
  const { t } = useTranslation();
  const [currentIndex, setCurrentIndex] = useState(0);
  const carouselRef = useRef(null);
  const cardRefs = useRef({});
  const [isHovered, setIsHovered] = useState(null);
  
  // Get indices of previous, current and next cards using useCallback to avoid dependency issues
  const getPrevIndex = useCallback((index) => {
    return index === 0 ? projects.length - 1 : index - 1;
  }, [projects.length]);
  
  const getNextIndex = useCallback((index) => {
    return index === projects.length - 1 ? 0 : index + 1;
  }, [projects.length]);

  const handleNext = useCallback(() => {
    setCurrentIndex((prevIndex) => getNextIndex(prevIndex));
  }, [getNextIndex]);

  const handlePrevious = useCallback(() => {
    setCurrentIndex((prevIndex) => getPrevIndex(prevIndex));
  }, [getPrevIndex]);

  const handleMouseMove = (e, id) => {
    if (!cardRefs.current[id]) return;
    const card = cardRefs.current[id];
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left - rect.width / 2;
    const y = e.clientY - rect.top - rect.height / 2;
    // Increased rotation sensitivity for more dramatic effect
    const rotateX = (-y / 15).toFixed(2);
    const rotateY = (x / 15).toFixed(2);
    // Add slight translation based on mouse position for enhanced depth effect
    const translateX = (x / 50).toFixed(2);
    const translateY = (y / 50).toFixed(2);
    card.style.transform = `perspective(1500px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateX(${translateX}px) translateY(${translateY}px) ${getCardTransform(id)}`;
  };

  const resetTransform = (id) => {
    if (!cardRefs.current[id]) return;
    cardRefs.current[id].style.transform = `${getCardTransform(id)}`;
    setIsHovered(null);
  };

  const handleBtnHover = (id) => {
    setIsHovered(id);
  };

  // Get transform style for each card based on position with enhanced depth effect
  const getCardTransform = (index) => {
    if (index === currentIndex) {
      return 'translateZ(150px) scale(1.1)';
    } else if (index === getPrevIndex(currentIndex)) {
      return 'translateX(-85%) translateZ(-200px) scale(0.7) rotateY(25deg)';
    } else if (index === getNextIndex(currentIndex)) {
      return 'translateX(85%) translateZ(-200px) scale(0.7) rotateY(-25deg)';
    } else {
      return 'translateX(0) translateZ(-400px) scale(0.5) opacity(0)';
    }
  };

  // Get z-index for proper layering
  const getZIndex = (index) => {
    if (index === currentIndex) return 3;
    if (index === getPrevIndex(currentIndex) || index === getNextIndex(currentIndex)) return 2;
    return 1;
  };

  // Get opacity based on position with enhanced depth effect
  const getOpacity = (index) => {
    if (index === currentIndex) return 1;
    if (index === getPrevIndex(currentIndex) || index === getNextIndex(currentIndex)) return 0.6;
    return 0;
  };

  // Auto-scroll effect
  useEffect(() => {
    const interval = setInterval(() => {
      handleNext();
    }, 15000); // Change slide every 15 seconds

    return () => clearInterval(interval);
  }, [handleNext]);

  return (
    <div className="project-carousel">
      <button 
        className="carousel-btn carousel-btn-prev" 
        onClick={handlePrevious}
        aria-label="Previous project"
      >
        &lt;
      </button>

      <div className="carousel-container" ref={carouselRef}>
        <div className="carousel-track">
          {projects.map((project, index) => {
            const isActive = index === currentIndex;
            const isVisible = index === currentIndex || 
                             index === getPrevIndex(currentIndex) || 
                             index === getNextIndex(currentIndex);
            const isHiddenButton = project.key === "project1";

            return (
              <div
                key={index}
                ref={el => cardRefs.current[index] = el}
                className={`project-card-alt carousel-card ${isActive ? 'active' : ''} ${isVisible ? 'visible' : ''}`}
                style={{
                  borderLeft: `4px solid ${project.accent}`,
                  transform: getCardTransform(index),
                  zIndex: getZIndex(index),
                  opacity: getOpacity(index),
                  pointerEvents: isActive ? 'auto' : 'none'
                }}
                onMouseMove={(e) => isActive && handleMouseMove(e, index)}
                onMouseLeave={() => resetTransform(index)}
              >
                <div className="project-content">
                  <h3 style={{ color: project.accent }}>{t(`projects.${project.key}.title`)}</h3>
                  <p>{t(`projects.${project.key}.description`)}</p>
                  <motion.a
                    href={project.link || "#"}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="project-btn-futuristic"
                    onMouseEnter={() => handleBtnHover(index)}
                    onMouseLeave={() => setIsHovered(null)}
                    initial={{ opacity: isHiddenButton ? 0 : 1 }}
                    animate={{ opacity: isHiddenButton ? 0 : 1 }}
                    style={{
                      pointerEvents: isHiddenButton ? 'none' : 'auto',
                      cursor: isHiddenButton ? 'default' : 'pointer',
                    }}
                  >
                    <span>{isHovered === index ? t('projects.buttonHover') : t('projects.button')}</span>
                  </motion.a>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      <button 
        className="carousel-btn carousel-btn-next" 
        onClick={handleNext}
        aria-label="Next project"
      >
        &gt;
      </button>

      <div className="carousel-dots">
        {projects.map((_, index) => (
          <button
            key={index}
            className={`carousel-dot ${index === currentIndex ? 'active' : ''}`}
            onClick={() => setCurrentIndex(index)}
            aria-label={`Go to project ${index + 1}`}
          />
        ))}
      </div>
    </div>
  );
};

export default ProjectCarousel;
import React, { useState, useRef, useEffect, useCallback } from "react";
// eslint-disable-next-line no-unused-vars
import { motion } from "framer-motion";
import { useTranslation } from 'react-i18next';

const ProjectCarousel = ({ projects }) => {
  const { t } = useTranslation();
  const [currentIndex, setCurrentIndex] = useState(0);
  const carouselRef = useRef(null);
  const cardRefs = useRef({});
  const [isHovered, setIsHovered] = useState(null);
  
  // Get indices of previous, current and next cards using useCallback to avoid dependency issues
  const getPrevIndex = useCallback((index) => {
    return index === 0 ? projects.length - 1 : index - 1;
  }, [projects.length]);
  
  const getNextIndex = useCallback((index) => {
    return index === projects.length - 1 ? 0 : index + 1;
  }, [projects.length]);

  const handleNext = useCallback(() => {
    setCurrentIndex((prevIndex) => getNextIndex(prevIndex));
  }, [getNextIndex]);

  const handlePrevious = useCallback(() => {
    setCurrentIndex((prevIndex) => getPrevIndex(prevIndex));
  }, [getPrevIndex]);

  const handleMouseMove = (e, id) => {
    if (!cardRefs.current[id]) return;
    const card = cardRefs.current[id];
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left - rect.width / 2;
    const y = e.clientY - rect.top - rect.height / 2;
    const rotateX = (-y / 20).toFixed(2);
    const rotateY = (x / 20).toFixed(2);
    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) ${getCardTransform(id)}`;
  };

  const resetTransform = (id) => {
    if (!cardRefs.current[id]) return;
    cardRefs.current[id].style.transform = `${getCardTransform(id)}`;
    setIsHovered(null);
  };

  const handleBtnHover = (id) => {
    setIsHovered(id);
  };

  // Get transform style for each card based on position with responsive values
  const getCardTransform = (index) => {
    // Adjust values based on screen width
    const isMobile = window.innerWidth <= 768;
    const isSmallMobile = window.innerWidth <= 480;
    
    // Use more conservative values on mobile to prevent cut-off
    const xOffset = isSmallMobile ? 60 : isMobile ? 65 : 70;
    const zOffset = isSmallMobile ? -80 : isMobile ? -90 : -100;
    const activeScale = isSmallMobile ? 0.95 : isMobile ? 0.98 : 1;
    const sideScale = isSmallMobile ? 0.75 : isMobile ? 0.78 : 0.8;
    const rotationDegree = isSmallMobile ? 8 : isMobile ? 9 : 10;
    
    if (index === currentIndex) {
      return `translateZ(0) scale(${activeScale})`;
    } else if (index === getPrevIndex(currentIndex)) {
      return `translateX(-${xOffset}%) translateZ(${zOffset}px) scale(${sideScale}) rotateY(${rotationDegree}deg)`;
    } else if (index === getNextIndex(currentIndex)) {
      return `translateX(${xOffset}%) translateZ(${zOffset}px) scale(${sideScale}) rotateY(-${rotationDegree}deg)`;
    } else {
      return 'translateX(0) translateZ(-200px) scale(0.6) opacity(0)';
    }
  };

  // Get z-index for proper layering
  const getZIndex = (index) => {
    if (index === currentIndex) return 3;
    if (index === getPrevIndex(currentIndex) || index === getNextIndex(currentIndex)) return 2;
    return 1;
  };

  // Get opacity based on position
  const getOpacity = (index) => {
    if (index === currentIndex) return 1;
    if (index === getPrevIndex(currentIndex) || index === getNextIndex(currentIndex)) return 0.7;
    return 0;
  };

  // Auto-scroll effect
  useEffect(() => {
    const interval = setInterval(() => {
      handleNext();
    }, 15000); // Change slide every 15 seconds

    return () => clearInterval(interval);
  }, [handleNext]);

  return (
    <div className="project-carousel">
      <button 
        className="carousel-btn carousel-btn-prev" 
        onClick={handlePrevious}
        aria-label="Previous project"
      >
        &lt;
      </button>

      <div className="carousel-container" ref={carouselRef}>
        <div className="carousel-track">
          {projects.map((project, index) => {
            const isActive = index === currentIndex;
            const isVisible = index === currentIndex || 
                             index === getPrevIndex(currentIndex) || 
                             index === getNextIndex(currentIndex);
            const isHiddenButton = project.key === "project1";

            return (
              <div
                key={index}
                ref={el => cardRefs.current[index] = el}
                className={`project-card-alt carousel-card ${isActive ? 'active' : ''} ${isVisible ? 'visible' : ''}`}
                style={{
                  borderLeft: `4px solid ${project.accent}`,
                  transform: getCardTransform(index),
                  zIndex: getZIndex(index),
                  opacity: getOpacity(index),
                  pointerEvents: isActive ? 'auto' : 'none'
                }}
                onMouseMove={(e) => isActive && handleMouseMove(e, index)}
                onMouseLeave={() => resetTransform(index)}
              >
                <div className="project-content">
                  <h3 style={{ color: project.accent }}>{t(`projects.${project.key}.title`)}</h3>
                  <p>{t(`projects.${project.key}.description`)}</p>
                  <motion.a
                    href={project.link || "#"}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="project-btn-futuristic"
                    onMouseEnter={() => handleBtnHover(index)}
                    onMouseLeave={() => setIsHovered(null)}
                    initial={{ opacity: isHiddenButton ? 0 : 1 }}
                    animate={{ opacity: isHiddenButton ? 0 : 1 }}
                    style={{
                      pointerEvents: isHiddenButton ? 'none' : 'auto',
                      cursor: isHiddenButton ? 'default' : 'pointer',
                    }}
                  >
                    <span>{isHovered === index ? t('projects.buttonHover') : t('projects.button')}</span>
                  </motion.a>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      <button 
        className="carousel-btn carousel-btn-next" 
        onClick={handleNext}
        aria-label="Next project"
      >
        &gt;
      </button>

      <div className="carousel-dots">
        {projects.map((_, index) => (
          <button
            key={index}
            className={`carousel-dot ${index === currentIndex ? 'active' : ''}`}
            onClick={() => setCurrentIndex(index)}
            aria-label={`Go to project ${index + 1}`}
          />
        ))}
      </div>
    </div>
  );
};

export default ProjectCarousel;
